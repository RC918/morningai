# 服務監控運維規範實施清單

## A. 每日固定產出

- [ ] **服務健康檢查**
    - [ ] `GET /health`
    - [ ] `GET /healthz`
    - [ ] `GET /openapi.json`（確認 `/auth/`、`/referral/` 在列）
- [ ] **效能與錯誤監控**
    - [ ] P95 延遲
    - [ ] 錯誤率（4xx/5xx 比例）
    - [ ] 過去 24h 的 5xx 峰值時段
- [ ] **資源與依賴監控**
    - [ ] Render 服務狀態（Events 截圖）
    - [ ] 資料庫連線健康度（連線數、錯誤數）
- [ ] **監控與告警**
    - [ ] Sentry/UptimeRobot 告警事件摘要與處置
- [ ] **日誌上傳**
    - [ ] 以「7 天觀察期監控日誌 – Day N」為檔名存檔與回報
- [ ] **交付格式**
    - [ ] Slack #morningai-alerts 發一則每日簡報
    - [ ] 附上 3–5 張證據截圖
    - [ ] 文字小結（≦10 行）

## B. 自動監控

- [ ] **每小時健檢腳本**
    - [ ] 探測 `/health`
    - [ ] 探測 `/healthz`
    - [ ] 探測 `/auth/register`（dry-run/mock）
    - [ ] 探測 `/referral/stats`（auth）
- [ ] **告警門檻**
    - [ ] **警告**：錯誤率 ≥ 1%（10 分鐘視窗）
    - [ ] **嚴重**：錯誤率 ≥ 5% 或 5xx 連續 3 次
    - [ ] **警告**：P95 > 500ms 持續 10 分鐘
    - [ ] **嚴重**：健康檢查連續 2 次非 200

## C. 異常處置

- [ ] **界定範圍**
    - [ ] 確認僅單一路由或全域
    - [ ] 比對 Cloudflare → Render 直連差異
- [ ] **快修**
    - [ ] **Render**：回滾到上一個 Live commit；重啟服務（不動 DNS）
    - [ ] **Cloudflare Worker**：若誤攔 /auth/* 或 /referral/*，立即暫停規則並備註原因
- [ ] **恢復驗證**
    - [ ] 五條 curl 驗收一次過
    - [ ] 補交「事故 5W1H」簡報（≦15 分鐘）

## D. 變更凍結

- [ ] **觀察期內**
    - [ ] 不得調整 Environment Groups、路由、DNS、Worker 規則與部署參數
- [ ] **試驗性調整**
    - [ ] 提「變更單」：影響面、回滾點、驗收方式、時窗

