


# Phase 5: AI 任務編排與 Meta-Agent - 產品需求文件 (PRD)

**版本**: 2.0
**更新日期**: 2025-09-12

## 1. 總覽

本階段的核心目標是建立 Morning AI 的「大腦」—— **AI Orchestrator**，並引入 **Meta-Agent** 的概念，實現從「單一 Agent 執行任務」到「多 Agent 協同完成複雜目標」的質變。這是實現 **SaaS 系統完全自主管理** 的關鍵基石。

## 2. 戰略目標

- **建立自主協作框架**: 打造一個能夠智能分解、調度、監控和管理多個 AI Agent 協同工作的核心引擎。
- **實現高階指令理解**: 讓系統能夠理解模糊的、高層次的業務目標，並將其自動轉化為可執行的 Agent 任務流。
- **奠定自治運營基礎**: 為後續的產品開發、客戶服務、市場行銷等全流程自動化提供核心技術支撐。

## 3. 核心功能需求

### 3.1. AI Orchestrator 核心引擎

| 功能點 | 需求描述 | 優先級 |
|---|---|---|
| **工作流引擎 (LangGraph)** | - 應採用基於有向無環圖 (DAG) 的 LangGraph 框架。<br>- 支持節點（Agent）、邊（任務流轉）、條件分支和並行執行。<br>- 工作流定義應採用「代碼即工作流」(YAML 格式)，便於版本控制。 | P0 |
| **狀態持久化** | - 每個工作流實例的完整狀態（包括輸入、輸出、中間結果、錯誤信息）必須持久化到 PostgreSQL 資料庫。<br>- 應支持任務的中斷、恢復和重試。 | P0 |
| **智能任務分解** | - Orchestrator 需具備將高階目標（如「開發一個新功能」）分解為一系列具體子任務的能力。<br>- 應利用一個「規劃 Agent」(Planner Agent) 來生成初始的任務圖。 | P1 |
| **動態 Agent 調度** | - 根據任務類型、優先級和 Agent 的當前負載，動態地將任務分派給最合適的 Agent。 | P1 |

### 3.2. Meta-Agent 與 Agent Pool

| 功能點 | 需求描述 | 優先級 |
|---|---|---|
| **Agent 註冊與發現** | - 應建立一個 Agent 註冊中心，所有可用的 Agent 都需要在此註冊其能力、輸入/輸出 schema 和健康檢查端點。<br>- Orchestrator 通過此中心來發現和調用 Agent。 | P0 |
| **標準化 Agent 接口** | - 所有 Agent 必須遵循統一的異步接口規範，接收標準化的任務對象，並返回標準化的結果對象。 | P0 |
| **核心 Agent 實現 (MVP)** | - **ProductMaster**: 負責產品規劃和 PRD 撰寫。<br>- **CodeWriter**: 負責程式碼開發。<br>- **QAAuditor**: 負責自動化測試。 | P1 |

### 3.3. AI 治理主控台 (Governance Console) 整合

| 功能點 | 需求描述 | 優先級 |
|---|---|---|
| **Agent Map 視覺化** | - 在主控台提供一個實時的 Agent 協作網絡圖，視覺化展示任務流轉和 Agent 狀態。<br>- 節點顏色、大小應能反映 Agent 的狀態和負載。 | P1 |
| **對話式指令接口** | - 主控台應提供一個自然語言輸入框，允許管理者輸入高階指令來觸發工作流。 | P2 |
| **HITL 審批中心** | - 所有需要人工決策的節點（如 PRD 審批、部署審批）必須將任務發送到審批中心。<br>- 支持通過 Web 界面、Telegram Bot 和 Email 進行審批操作。 | P1 |

## 4. 用戶故事

- **作為一名系統管理員**，我希望能通過一句話（如「為專業版用戶增加一個數據導出功能」）就能啟動整個新功能的開發流程，而不需要手動去協調不同的團隊。
- **作為一名產品經理**，我希望在我完成 PRD 撰寫後，系統能自動將其流轉給開發和測試團隊，並在需要我審批時主動通知我。
- **作為一名運營者**，我希望能在一個儀表板上實時看到所有自動化任務的執行情況，並在出現異常時第一時間收到告警。

## 5. 非功能性需求

- **可擴展性**: 系統應能支持數百個 Agent 的並行協作，工作流引擎不應成為瓶頸。
- **可靠性**: 任何單個 Agent 的失敗不應導致整個系統崩潰。Orchestrator 必須有健全的重試和容錯機制。
- **可觀測性**: 所有任務的執行日誌、耗時、狀態變更都必須被記錄，並可在 Grafana 中查詢和視覺化。
- **安全性**: Agent 之間的通信、Agent 對外部工具的調用都必須經過嚴格的認證和授權。

## 6. 技術規格與實現方案

- **核心框架**: LangGraph
- **後端服務**: FastAPI (Python 3.11)
- **狀態存儲**: PostgreSQL
- **異步任務隊列**: RabbitMQ
- **前端 (主控台)**: Next.js + D3.js

詳細技術方案請參考架構設計文件：`../系統與資料/architecture.drawio` 和 `../實作方式/orchestrator_technical_solution.md`。

## 7. 驗收標準

- 能夠成功執行一個完整的、包含至少 3 個 Agent（ProductMaster, CodeWriter, QAAuditor）和 1 個 HITL 節點的「新功能開發」工作流。
- Agent Map 能夠準確、實時地反映工作流的執行狀態。
- HITL 審批可以通過 Telegram Bot 成功觸發並完成。
- 所有工作流的執行記錄都可以在資料庫中被查詢到。


