# 覆蓋率提升策略：50% → 60%+

## 當前狀態
- 總體覆蓋率：50%
- main.py：53%
- 目標：60%+

## 策略：聚焦高價值模塊

### 優先級 1：main.py (53% → 65%)
**影響**：最大的文件，556 行，264 行未覆蓋
**目標**：+12% (約 67 行新覆蓋)
**方法**：
1. 測試未覆蓋的 Phase 4-6 端點（lines 585-947）
2. 添加錯誤處理測試
3. 測試條件導入分支

**ROI**：高 - 這是主要應用文件

### 優先級 2：routes/auth.py (83% → 95%)
**影響**：關鍵認證模塊，53 行，9 行未覆蓋
**目標**：+12% (約 6 行新覆蓋)
**方法**：
1. 測試錯誤處理分支
2. 測試邊界條件

**ROI**：高 - 安全關鍵，易於測試

### 優先級 3：routes/agent.py (72.5% → 85%)
**影響**：Agent 路由，160 行，44 行未覆蓋
**目標**：+12.5% (約 20 行新覆蓋)
**方法**：
1. 測試錯誤處理
2. 測試調試端點的邊界情況

**ROI**：中高 - 核心功能

### 優先級 4：middleware/auth_middleware.py (56% → 70%)
**影響**：認證中間件，126 行，55 行未覆蓋
**目標**：+14% (約 18 行新覆蓋)
**方法**：
1. 測試角色權限檢查
2. 測試 JWT 生成與驗證邊界情況

**ROI**：高 - 安全關鍵

## 計算的總體影響

如果達成所有目標：
- main.py: +67 行 (53% → 65%)
- auth.py: +6 行 (83% → 95%)
- agent.py: +20 行 (72.5% → 85%)
- auth_middleware.py: +18 行 (56% → 70%)

**總計**: ~111 行新覆蓋
**預期總體覆蓋率**: 50% → 56-58%

## 實際目標調整

要達到 60%，我們需要覆蓋約 174 行 (60% of 1740 = 1044, currently 869)

**調整策略**：
1. 完成上述所有優先級
2. 額外添加 routes/dashboard.py 測試（83% → 95%）
3. 添加更多 main.py Phase 4-6 端點測試

## 測試質量優化

同時進行：
1. 增強現有斷言 - 更嚴格的驗證
2. 添加邊界條件測試
3. 改進錯誤處理測試
4. 確保所有測試都有意義的驗證
